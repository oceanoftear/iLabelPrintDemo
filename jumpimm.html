<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>视频导引自动跳转</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      text-align: center;
      padding: 40px 20px;
      background-color: #f5f5f5;
    }
    h1 {
      font-size: 22px;
      margin-bottom: 16px;
    }
    p {
      font-size: 15px;
      color: #555;
      line-height: 1.6;
    }
    .debug {
      margin-top: 24px;
      padding: 12px 16px;
      background: #fff;
      border-radius: 6px;
      display: inline-block;
      text-align: left;
      font-size: 14px;
      color: #333;
      box-shadow: 0 0 4px rgba(0,0,0,0.1);
      max-width: 90vw;
      word-break: break-all;
    }
    pre {
      white-space: pre-wrap;
      text-align: left;
      font-size: 12px;
      background: #f0f0f0;
      padding: 8px;
      border-radius: 4px;
      max-height: 200px;
      overflow: auto;
    }
  </style>

  <script>
    const BILIBILI_URL = "https://www.bilibili.com/video/你的B站视频ID";
    const YOUTUBE_URL = "https://www.youtube.com/watch?v=你的YouTube视频ID";

    const IP_API_KEY = "301ed89d283d26a97a703c341bbfb0ed"; // 换成 iplocate.io 后台的真实 Key[web:60][web:65]

    let detectedCountryCode = null;
    let targetUrl = null;

    function decideTarget(countryCode) {
      if (countryCode === "CN") {
        targetUrl = BILIBILI_URL;
        return "检测到国家代码为 CN，将跳转到：B站";
      } else {
        targetUrl = YOUTUBE_URL;
        return "检测到国家代码为 " + countryCode + "，将跳转到：YouTube";
      }
    }

    function updateDebug(info) {
      const elCountry = document.getElementById("countryCode");
      const elInfo = document.getElementById("infoText");
      const elError = document.getElementById("errorText");
      const elRaw = document.getElementById("rawJson");

      if (info.countryCode !== undefined) {
        elCountry.textContent = info.countryCode || "(无)";
      }
      if (info.text !== undefined) {
        elInfo.textContent = info.text;
      }
      if (info.error !== undefined) {
        elError.textContent = info.error;
      }
      if (info.raw !== undefined) {
        elRaw.textContent = info.raw;
      }
    }

    function redirectNow() {
      if (targetUrl) {
        // 直接跳转[web:77][web:79]
        window.location.href = targetUrl;
      }
    }

    document.addEventListener("DOMContentLoaded", function () {
      updateDebug({
        countryCode: "",
        text: "正在调用 IPLocate API 获取您的国家代码…",
        error: "",
        raw: ""
      });

      const url = "https://iplocate.io/api/lookup?apikey=" + encodeURIComponent(IP_API_KEY); // 官方示例形式[web:23][web:41]

      fetch(url)
        .then(function (res) {
          return res.json();
        })
        .then(function (data) {
          console.log("IPLocate 返回数据:", data);
          updateDebug({
            raw: JSON.stringify(data, null, 2)
          });

          detectedCountryCode = data && data.country_code ? data.country_code : null; // 按文档读取 country_code[web:41][web:43]

          if (detectedCountryCode) {
            const desc = decideTarget(detectedCountryCode);
            updateDebug({
              countryCode: detectedCountryCode,
              text: desc,
              error: ""
            });

            // ★ 检测到国码后，自动跳转（可加一点点延时，方便你看调试信息）
            setTimeout(redirectNow, 800); // 0.8 秒后自动跳转
          } else {
            updateDebug({
              countryCode: "(未获取到)",
              text: "未从 API 返回中解析到 country_code 字段，暂不跳转。",
              error: "请检查：1）API Key 是否正确；2）返回 JSON 结构（看上面的原始数据）。"
            });
          }
        })
        .catch(function (err) {
          console.error("Geo lookup error:", err);
          updateDebug({
            countryCode: "(错误)",
            text: "调用 IPLocate API 时发生错误，已停止自动跳转。",
            error: "错误详情已输出到浏览器控制台（F12）。",
            raw: ""
          });
        });
    });
  </script>
</head>
<body>
  <h1>正在为您自动选择视频平台…</h1>
  <p>系统会根据您所在地区自动跳转到合适的视频平台，通常在 1 秒内完成。</p>

  <div class="debug">
    <div>检测到的国家代码（country_code）：<span id="countryCode">（等待检测…）</span></div>
    <div style="margin-top:8px;">说明：<span id="infoText"></span></div>
    <div style="margin-top:8px; color:#c00;">错误信息：<span id="errorText"></span></div>
    <div style="margin-top:8px;">API 原始返回：</div>
    <pre id="rawJson">{}</pre>
  </div>

  <div class="loading">如需进一步调试，可按 F12 打开开发者工具 → Console 查看详细日志。</div>
</body>
</html>
